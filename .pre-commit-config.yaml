repos:
  - repo: local
    hooks:
      - id: dotnet-tool-restore
        name: Install .NET tools
        entry: dotnet tool restore
        language: system
        always_run: true
        pass_filenames: false
        stages:
          - pre-commit
          - pre-push
          - post-checkout
          - post-rewrite
        description: Install the .NET tools listed at .config/dotnet-tools.json.
      - id: csharpier
        name: Run CSharpier on C# files
        entry: dotnet tool run csharpier format
        language: system
        types:
          - c#
        description: CSharpier is an opinionated C# formatter inspired by Prettier.

  - repo: local
    hooks:
      - id: prettier
        name: Prettier (Markdown, JSON, asmdef, asmref, YAML)
        entry: npx --yes prettier@3.6.2 --write
        language: system
        files: '(?i)\.(md|markdown|json|asmdef|asmref|ya?ml)$'
        description: Use pinned Prettier version to match CI.

  - repo: local
    hooks:
      - id: markdown-structure-fix
        name: Markdown structure auto-fix (headings, fences)
        entry: node scripts/fix-md036-headings.js
        language: system
        files: '(?i)\.(md|markdown)$'
        description: Auto-fix MD036 (no-emphasis-as-heading) by converting bold-only lines to headings.

  - repo: local
    hooks:
      - id: markdownlint
        name: markdownlint (respect repo config)
        entry: npx --yes markdownlint-cli2@0.17.1 --config .markdownlint.jsonc
        language: system
        files: '(?i)\.(md|markdown)$'

  - repo: local
    hooks:
      - id: yamllint
        name: yamllint (if available)
        entry: bash -c 'if command -v yamllint >/dev/null 2>&1; then yamllint -c .yamllint.yaml "$@"; else echo "yamllint not installed; skipping"; fi' --
        language: system
        files: '(?i)\.(ya?ml)$'

  - repo: local
    hooks:
      - id: fix-eol
        name: Normalize CRLF and strip BOM
        entry: node scripts/fix-eol.js
        language: system
        stages:
          - pre-commit
        pass_filenames: true
        description: Automatically rewrite text files to match CI EOL/BOM policy.

  - repo: local
    hooks:
      - id: eol-bom-check
        name: Enforce CRLF and no BOM
        entry: node scripts/check-eol.js
        language: system
        pass_filenames: true
        stages:
          - pre-commit
          - pre-push

  - repo: local
    hooks:
      - id: conflict-markers
        name: Fail on merge conflict markers
        entry: bash -lc 'if rg -n -S -g "!**/.git/**" -e "^(<<<<<<<|=======|>>>>>>>)" .; then echo "Conflict markers found. Resolve merges before committing." >&2; exit 1; fi'
        language: system
        pass_filenames: false
        stages:
          - pre-commit
